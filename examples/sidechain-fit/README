EXAMPLE "SIDECHAIN FIT", Mike Devereux 2022

This complex example shows a complete workflow to fit new charge parameters for
a single residue side chain, starting from a CHARMM setup and ending with a DCM
parameter file to feed back into CHARMM. The steps are:

1. Set up a system in CHARMM where the residue of interest is capped with two
neutral terminal groups. Optimize the system to obtain the minimum-energy
structure, run a gas-phase simulation to generate at least one additional,
perturbed structure so that we can average over multiple conformers, and dump
CHARMM charges for the whole system (including terminal groups) so that we can
fix the backbone charges during fitting.

2. Run Gaussian calculations for the reference structures created in step 1 in
order to generate reference electron density and ESP grids in "CUBE" file
format. This data will be used for ESP-fitting of the new model

3. A simple means of fixing the backbone charges is to remove them and the ESP
that they generate from the reference grids. New ESP and density grids are
created with the amino acid backbone atoms removed and the ESP from their
charges subtracted from the reference ESP.

4. Fit high-rank atomic multipoles (l=5) to the ESP with the backbone atoms
removed.

5. Fit atomic charge models to the ESP generated by the atomic multipole
moments. Several fits are performed simultaneously to ensure that models that
perform well are identified

6. Use the atomic models to create an initial guess population for fitting of
molecular charge models with different numbers of charges. As the system is
quite large and we run multiple fits, this step will be the slowest. If more
charges are required or time is an issue, a fragment approach is preferable and
may even yield better results due to more complete sampling. See the example
"FRAGMENT MULTICONF" for more details

7. Evaluate the quality of the fit for any model you wish to pursue further,
using the ESP without capping groups as a reference.

8. In this step the charges that were initially removed (backbone charges and
capping groups) are added to the newly fitted model and another evaluation of
the quality of the overall model, including the added charges, is performed
using the original, unmodified Gaussian ESP data for the whole system as
reference.

9. This step removes the capping groups in order to create a residue that is
compatible with standard CHARMM (where residues have hanging bonds that are then
patched either to the next residue in the sequence or to a capping group). This
must be done manually, once complete a .dcm parameter file is created that can
be used in CHARMM simulations.

10. The newly created .dcm file containing the model with fitted side chain is
loaded into CHARMM and tested by printing system coordinates to check that
charges are correctly placed, and also by running dynamics.
